<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transforming DeepGSR: a light-weight genomic signal classifier</title>
    <style>
        body { font-family: sans-serif; max-width: 800px; margin: 2rem auto; padding: 0 1rem; line-height: 1.6; }
        .container { background: #f4f4f9; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        textarea { width: 100%; height: 120px; font-family: monospace; margin: 1rem 0; }
        .controls { display: flex; gap: 1rem; align-items: center; margin-bottom: 1rem; }
        button { background: #007bff; color: white; border: none; padding: 0.6rem 1.2rem; border-radius: 4px; cursor: pointer; }
        button:disabled { background: #ccc; }
        #result { margin-top: 1.5rem; padding: 1rem; border-radius: 4px; display: none; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .loading { font-style: italic; color: #555; }
    </style>
</head>
<body>

<div class="container">
    <h2>üß¨ Transforming DeepGSR: a light-weight genomic signal classifier</h2>
    <p>Classify sequences as Positive or Negative using light-weight Transformer models.</p>

    <p>For PAS (motif AATAAA), sequences must have 606 nucleotides.</p>
    <p>For TIS (motif ATG), sequences must have 603 nucleotides.</p>

    <div class="controls">
        <label for="signalType">Select Signal:</label>
        <select id="signalType">
            <option value="PAS">PAS (Polyadenylation Signal)</option>
            <option value="TIS">TIS (Translation Initiation Site)</option>
        </select>
    </div>

    <textarea id="sequenceInput" placeholder="Paste genomic sequence here (A, C, G, T)..."></textarea>
    
    <button id="classifyBtn">Classify Sequence</button>
    
    <div id="status" class="loading" style="display:none;">Loading model...</div>
    <div id="result"></div>

    <p>Transforming DeepGSR is a light-weight model for recognizing genomic regulatory signals, such as polyadenylation sites (PAS) and translation initiation sites (TIS). Our approach significantly reduces model size while maintaining competitive performance. Using trinucleotide tokenization and models with fewer than 2.2 million parameters, we train on PAS and TIS datasets from human, mouse, bovine, and fruit fly. The models achieve accuracies of up to 83.5% for PAS and 93.1% for TIS. Compared to alternative low-capacity models, the Transformer outperforms in precision and recall, offering a practical solution for bioinformatics applications in resource-limited environments.</p>
</div>

<script type="module">
    // Import Transformers.js from CDN
    import { pipeline, env } from 'https://cdn.jsdelivr.net/npm/@huggingface/transformers';

    // 1. Disable remote downloads to stop the "Invalid Model ID" fallback error
    env.allowRemoteModels = false;
    env.allowLocalModels = true;
    env.useBrowserCache = false;

    // 2. Set the base path for your models. 
    // If your 'models' folder is in the same directory as index.html, use './'
    env.localModelPath = './';

    const classifierCache = {};

    const btn = document.getElementById('classifyBtn');
    const resultDiv = document.getElementById('result');
    const statusDiv = document.getElementById('status');

    async function classify() {
        const type = document.getElementById('signalType').value;
        const rawSequence = document.getElementById('sequenceInput').value.trim().toUpperCase();
        const config = {
            PAS: { length: 606, motif: "AATAAA", motifStart: 300, motifEnd: 306, path: 'models/PAS_model' },
            TIS: { length: 603, motif: "ATG",    motifStart: 300, motifEnd: 303, path: 'models/TIS_model' }
        };

        const settings = config[type];

        // 1. Basic Length and Character Validation
        if (rawSequence.length !== settings.length) {
            showResult(`Invalid length. ${type} requires ${settings.length} nts.`, true);
            return;
        }
        if (!/^[ACGT]+$/.test(rawSequence)) {
            showResult("Sequence must only contain A, C, G, and T.", true);
            return;
        }

        // 2. Motif Validation (Positions 301+)
        const actualMotif = rawSequence.substring(settings.motifStart, settings.motifEnd);
        if (actualMotif !== settings.motif) {
            showResult(`Invalid Signal: Expected ${settings.motif} at position 301, found ${actualMotif}.`, true);
            return;
        }

        // 3. Upstream and Downstream Extraction
        // Upstream: 1 to 300 (Indices 0 to 300)
        // Downstream: (Following motif) to End
        let upstream = rawSequence.substring(0, 300);
        let downstream = rawSequence.substring(settings.motifEnd);

        // 4. Trimming: Remove the first 3 nucleotides from each
        upstream = upstream.substring(3);
        downstream = downstream.substring(3);

        // 5. Final Concatenation
        const processedSequence = upstream + downstream;
        // Length check: (300-3) + (300-3) = 594 nts (198 tokens)

        try {
            btn.disabled = true;
            statusDiv.style.display = 'block';
            resultDiv.style.display = 'none';

            if (!classifierCache[type]) {
                statusDiv.innerText = `Loading ${type} model...`;
                classifierCache[type] = await pipeline('text-classification', settings.path, { 
                    quantized: false, dtype: 'fp32'
                });
            }

            statusDiv.innerText = "Analyzing processed sequence...";
            const output = await classifierCache[type](processedSequence);

            const { label, score } = output[0];
            const isPositive = label === 'LABEL_1' || label.toUpperCase() === 'POSITIVE';

            showResult(`
                <strong>Result:</strong> ${isPositive ? '‚úÖ Positive' : '‚ùå Negative'}<br>
                <strong>Confidence:</strong> ${(score * 100).toFixed(2)}%<br>
            `, false);

        } catch (err) {
            console.error(err);
            showResult("Error during classification. Ensure model files are in the correct path.", true);
        } finally {
            btn.disabled = false;
            statusDiv.style.display = 'none';
        }
    }

    function showResult(html, isError) {
        resultDiv.innerHTML = html;
        resultDiv.style.display = 'block';
        resultDiv.className = isError ? 'error' : 'success';
    }

    btn.addEventListener('click', classify);
</script>

</body>
</html>